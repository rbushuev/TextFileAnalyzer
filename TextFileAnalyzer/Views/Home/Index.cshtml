@model FileSettingViewModel

@{
    ViewData["Title"] = "Home Page";
}

<form id="myForm" action="javascript:void(0);" method="POST" onsubmit="startHandle()">

    <div class="form-group row">
        <label class="col-sm-2 col-form-label">Имя новой базы данных</label>
        <div class="col-sm-10">
            <input class="form-control" type="text" asp-for="Name">
        </div>
    </div>

    <div class="form-group row">
        <label class="col-sm-2 col-form-label">Путь к файлу</label>
        <div class="col-sm-9">
            <input class="form-control" type="text" asp-for="PathFile">
        </div>
        <div class="col-sm-1">
            <button type=" " class="btn btn-primary">...</button>
        </div>
    </div>

    <div class="form-group row">
        <div class="col-sm-2"> </div>
        <div class="col-sm-10">
            <div class="form-check">
                <input class="form-check-input" asp-for="IsFirstString">
                <label class="form-check-label">Первая строка содержит заголовки</label>
            </div>
        </div>
    </div>

    <fieldset class="form-group">
        <div class="row">
            <label class="col-form-label col-sm-2 pt-0">Разделитель ячеек</label>
            <div class="col-sm-10">

                @foreach (SeparatorEnum item in Enum.GetValues(typeof(SeparatorEnum)))
                {
                <div class="form-check">
                    <input onclick="switchCustomSeparatorInput(this)" class="form-check-input" type="radio" asp-for="CellSeparator.SeparatorEnum" value="@((int)item)">
                    <label class="form-check-label">@(item)</label>
                    @{
                        if (item == SeparatorEnum.Custom)
                        {
                            <input id="customSeparatorInput" class="form-control col-sm-2" type="text" asp-for="CellSeparator.CustomSeparator" disabled>
                        }
                    }
                </div>
                }

            </div>
        </div>
    </fieldset>

    <div class="form-group row">
        <div class="col-sm-10">
            <button type="submit" class="btn btn-primary">Показать результат</button>
        </div>
    </div>

</form>

<table id="headersTable" class="table">
    <thead ></thead>
    <tbody ></tbody>
</table>

<table id="mainTable" class="table table-bordered table-hover">
    <thead id="theadInfo"></thead>
    <tbody id="tbodyInfo"></tbody>
</table>

<script>

    const uri = '/api/handletext';

    function switchCustomSeparatorInput(radioButton) {
        let customSeparatorInput = document.getElementById('customSeparatorInput');
        radioButton.value === '3' ? customSeparatorInput.disabled = false : customSeparatorInput.disabled = true;
    }
    
    function startHandle() {

        event.preventDefault();
        var formData = new FormData(this.event.target)

        fetch(uri, {
            method: "POST",
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                _displayItems(data);
            })
            .catch(error => console.error('ошибос', error));
    }

    function _displayItems(data) {
        _resetTable();
        _displayHeaders(data.headers);
        _displayRows(data.rows);
    }

    function _resetTable() {
        var table = document.getElementById('mainTable');
        while(table.rows.length > 0) {
          table.deleteRow(0);
        }
    }

    function _displayHeaders(headers) {
        const thead = document.getElementById('theadInfo');
        let tr = thead.insertRow();

        headers.forEach(header => {
            let headerNode = document.createElement("TH");
            headerNode.innerHTML = header;
            tr.appendChild(headerNode);
        });
    }

    function _displayRows(rows) {
        const tBody = document.getElementById('tbodyInfo');

        rows.forEach(row => {
            let tr = tBody.insertRow();

            row.cells.forEach(item => {
                let td = tr.insertCell();
                let textNode = document.createTextNode(item);
                td.appendChild(textNode);
            });
        });
    }

    function reset() {
        var form = document.forms["userForm"];
        form.reset();
        form.elements["id"].value = 0;
    }

</script>
